{{ $img := .Page.Resources.GetMatch (.Get "img") }}

{{ $prefix := "" }}
{{ if ne .Site.IsServer true }}
{{ $prefix = $.Site.Params.imgCDNUrl }}
{{ end }}

<figure{{ with .Get "modifier"}} class="figure-{{.}}"{{ end }}>
  {{ with .Get "link"}} <a href="{{.}}" class="block"> {{ end }}
  <picture>

    <source type="image/jpeg" srcset="{{ $prefix }}{{ $img.RelPermalink }}?w=768&org_if_sml=1 768w, {{ $prefix }}{{ $img.RelPermalink }}?w=1024&org_if_sml=1 1024w" sizes="(max-width: 768px),(max-width: 1024px)">
    {{ if ne $.Site.IsServer true }}
    <source type="image/webp" srcset="{{ $prefix }}{{ $img.RelPermalink }}?w=768&org_if_sml=1&force_format=webp 768w, {{ $prefix }}{{ $img.RelPermalink }}?w=1024&org_if_sml=1&force_format=webp 1024w" sizes="(max-width: 768px),(max-width: 1024px)">
    {{ end }}

    <img src='{{ $prefix }}{{ $img.RelPermalink }}?w=1280&org_if_sml=1'
        width="{{ $img.Width }}" height="{{ $img.Height }}"
        {{ with .Get "alt"}}alt="{{.}}"{{ end }}/>
  </picture>
  {{ with .Get "link"}} </a> {{ end }}
  {{ with .Get "caption"}}<figcaption class="text-center">{{ . }}</figcaption>{{ end }}
</figure>
